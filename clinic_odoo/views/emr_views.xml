<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <record id="view_emr_kunjungan_search" model="ir.ui.view">
      <field name="name">emr.kunjungan.search</field>
      <field name="model">pfn.kunjungan.pasien</field>
      <field name="priority">90</field>
      <field name="arch" type="xml">
        <search string="Cari Pasien Terregistrasi">
          <field name="no_reg"/>
          <field name="patient_id"/>
          <field name="doctor_id"/>
          <separator/>
          <filter string="Pasien Saya" name="my_patients" domain="[('doctor_id.user_id', '=', uid)]"/>
          <filter string="Belum Dilayani" name="not_served" domain="[('status_pelayanan','=','not_served')]"/>
          <filter string="Dalam Pelayanan" name="in_service" domain="[('status_pelayanan','=','in_service')]"/>
          <filter string="Selesai" name="finished" domain="[('status_pelayanan','=','finished')]"/>
          <filter string="Terverifikasi" name="verified" domain="[('status_pelayanan','=','verified')]"/>
          <group expand="0" string="Group By">
            <filter string="Dokter" name="grp_doctor" context="{'group_by':'doctor_id'}"/>
            <filter string="Poli" name="grp_poli" context="{'group_by':'poli_id'}"/>
            <filter string="Tanggal" name="grp_date" context="{'group_by':'visit_datetime'}"/>
          </group>
        </search>
      </field>
    </record>

    <record id="view_emr_kunjungan_list" model="ir.ui.view">
      <field name="name">emr.kunjungan.list</field>
      <field name="model">pfn.kunjungan.pasien</field>
      <field name="priority">90</field>
      <field name="arch" type="xml">
        <list string="EMR - Pasien Teregistrasi"
              create="false" delete="false" edit="false"
              decoration-success="status_pelayanan == 'verified'"
              decoration-warning="status_pelayanan == 'in_service'"
              decoration-muted="status_pelayanan == 'not_served'">
          <field name="no_rm" string="No. RM"/>
          <field name="patient_id" string="Pasien"/>
          <field name="umur_display" string="Umur"/>
          <field name="gender" string="Jenis Kelamin"/>
          <field name="phone" string="No.Tlp"></field>
          <field name="doctor_id" string="Dokter"/>
          <field name="visit_datetime" string="Tanggal &amp; Jam Regristrasi"/>
          <field name="queue_no" string="No. Antrian"/>
          <button name="action_take_patient" type="object" string="Ambil Pasien" class="oe_highlight"/>
        </list>
      </field>
    </record>

    <record id="action_emr_kunjungan" model="ir.actions.act_window">
      <field name="name">EMR</field>
      <field name="res_model">pfn.kunjungan.pasien</field>
      <field name="view_mode">list,form</field>
      <field name="view_id" ref="clinic_odoo.view_emr_kunjungan_list"/>
      <field name="search_view_id" ref="clinic_odoo.view_emr_kunjungan_search"/>
      <field name="domain">[('status_kunjungan','=','registered')]</field>
    </record>

    <menuitem id="menu_medical_record" name="Medical Record" parent="menu_dashboard_clinic" sequence="40"/>
    <menuitem id="menu_emr" name="EMR" parent="menu_medical_record" action="action_emr_kunjungan" sequence="10"/>

    <record id="emr_record_view_form" model="ir.ui.view">
      <field name="name">emr.record.form</field>
      <field name="model">emr.record</field>
      <field name="arch" type="xml">
        <form string="Electronic Medical Record">
          <header>
            <field name="name" class="oe_inline" readonly="1"/>
            <field name="state" widget="statusbar" statusbar_visible="not_served,in_service,finished,verified" string="Status"/>
          </header>
          <sheet>
            <group>
              <group string="Data Pasien">
                <field name="patient_id" readonly="1"/>
                <field name="no_rm" readonly="1"/>
                <field name="gender" readonly="1"/>
                <field name="umur_display" readonly="1"/>
                <field name="phone" readonly="1"/>
                <field name="email" readonly="1"/>
                <field name="alamat" readonly="1"/>
              </group>
              <group string="Registrasi">
                <field name="kunjungan_id" readonly="1"/>
                <field name="doctor_id" readonly="1"/>
                <field name="service_type_id" readonly="1"/>
                <field name="poli_id" readonly="1"/>
                <field name="divisi_id" readonly="1"/>
                <field name="visit_datetime" readonly="1"/>
                <field name="queue_no" readonly="1"/>
              </group>
            </group>

            <notebook>
              <page string="SOAP">
                <group>
                  <group string="Subyektif">
                    <field name="subj_keluhan"
                          placeholder="Masukkan data subyektif pasien di sini..."
                          style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                    <field name="subj_riwayat_peny" 
                    placeholder="Masukkan riwayat penyakit pasien di sini..."
                           style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                    <field name="subj_riwayat_alergi" 
                           placeholder="Masukkan riwayat alergi pasien di sini..."
                           style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                  </group>
                  <group string="Obyektif">
                    <field name="obj_td_sistol"
                            style="border: 1px solid #d4c4c4; padding: 5px; border-radius: 4px; width: 60px; text-align: center;"/>
                    <field name="obj_td_diastol"
                            style="border: 1px solid #d4c4c4; padding: 5px; border-radius: 4px; width: 60px; text-align: center;"/>
                    <field name="obj_nadi"
                            style="border: 1px solid #d4c4c4; padding: 5px; border-radius: 4px; width: 60px; text-align: center;"/>
                    <field name="obj_suhu"
                            style="border: 1px solid #d4c4c4; padding: 5px; border-radius: 4px; width: 60px; text-align: center;"/>   
                    <field name="obj_pemeriksaan_fisik"
                            style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                  </group>
                </group>

                <group string="Assessment">
                  <field name="diagnosis_line_ids">
                    <list editable="bottom">
                      <field name="diagnosa_name"/>
                      <field name="icd10_name"/>
                      <field name="icd10_code"/>
                    </list>
                  </field>
                  <field name="prognosis"
                          placeholder="Pilih prognosis pasien di sini..."
                          style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                </group>

                <group string="Plan">
                  <group>
                    <field name="procedure_line_ids" 
                           context="{'default_service_type_id': service_type_id}">
                      <list editable="bottom">
                        <field name="service_type_id" column_invisible="1"/>
                        
                        <field name="allowed_category_ids" column_invisible="1"/>
                        
                        <field name="tindakan_id" string="Tindakan"
                               domain="[('categ_id', 'in', allowed_category_ids)]"
                               options="{'no_create': True, 'no_create_edit':True}"/>
                               
                        <field name="tindakan_code" readonly="1"/>
                        <field name="tindakan_name" readonly="1"/>
                      </list>
                    </field>
                    
                    <field name="prescription_line_ids"
                           context="{'default_service_type_id': service_type_id}">
                      <list editable="bottom">
                        <field name="service_type_id" column_invisible="1"/>

                        <field name="allowed_category_ids" column_invisible="1"/>

                        <field name="obat_id" string="Obat"
                               domain="[('categ_id', 'in', allowed_category_ids)]"
                               options="{'no_create': True, 'no_create_edit':True}"/>
                               
                        <field name="obat_name" readonly="1"/>
                        <field name="note" string="Catatan"/>
                      </list>
                    </field>
                  </group>
                  <group>
                    <field name="edukasi"
                           style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                    <field name="rencana_tindakan"
                            style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                    <field name="rencana_tanggal"
                            style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                    <field name="rencana_catatan"
                            style="border: 1px solid #d4c4c4; padding: 10px; border-radius: 5px; background-color: #fcfcfc; min-height: 50px;"/>
                  </group>
                </group>
              </page>
              <page string="Odontogram">
                <field name="odontogram_frame" widget="html" readonly="1"/>
              </page>
            </notebook>
          </sheet>
        </form>
      </field>
    </record>

    <record id="emr_record_action" model="ir.actions.act_window">
      <field name="name">EMR Record</field>
      <field name="res_model">emr.record</field>
      <field name="view_mode">form</field>
      <field name="view_id" ref="emr_record_view_form"/>
      <field name="target">current</field>
    </record>

  </data>
</odoo>